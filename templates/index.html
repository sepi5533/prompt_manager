{% extends "base.html" %}

{% block title %}프롬프트 목록 - 프롬프트 관리 시스템{% endblock %}

{% block page_title %}프롬프트 목록{% endblock %}

{% block page_actions %}
<a href="{{ url_for('new_prompt') }}" class="btn-glass btn-glass-primary">
    <i class="fas fa-plus"></i>
    새 프롬프트
</a>
<a href="{{ url_for('pwa_test') }}" class="btn-glass" style="margin-left: var(--spacing-2);">
    <i class="fas fa-mobile-alt"></i>
    PWA 테스트
</a>
{% endblock %}

{% block content %}
<!-- 검색 및 필터 -->
<div class="search-container">
    <form method="GET" class="search-form">
        <div class="input-group">
            <input type="text" name="search" value="{{ search }}" placeholder="프롬프트 검색..."
                class="input-glass search-input">
            <i class="fas fa-search input-group-icon"></i>
        </div>

        <select name="category" class="input-glass category-filter" style="width: 20ch;">
            <option value="">모든 카테고리</option>
            {% for category in categories %}
            <option value="{{ category.name }}" {% if category.name==selected_category %}selected{% endif %}>
                {{ category.name }}
            </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-glass btn-glass-primary"
            style="background: var(--color-primary); color: var(--color-white);">
            검색
        </button>

        {% if search or selected_category %}
        <a href="{{ url_for('index') }}" class="btn-glass">
            <i class="fas fa-times"></i>
            초기화
        </a>
        {% endif %}
    </form>
</div>

<!-- 프롬프트 그리드 -->
{% if prompts %}
<div class="prompt-grid">
    {% for prompt in prompts %}
    <div class="prompt-card animate-fade-in-up" style="animation-delay: {{ loop.index * 0.1 }}s;">
        <div class="prompt-header">
            <h3 class="prompt-title">
                <a href="{{ url_for('view_prompt', id=prompt.id) }}" style="color: inherit; text-decoration: none;">
                    {{ prompt.title }}
                </a>
            </h3>
            <span class="prompt-category" style="background: {{ prompt.category_color or '#6366f1' }}">
                {{ prompt.category_name or prompt.category }}
            </span>
        </div>

        <div class="prompt-content">
            {% if prompt.description %}
            {{ prompt.description }}
            {% else %}
            {{ prompt.content[:150] }}{% if prompt.content|length > 150 %}...{% endif %}
            {% endif %}
        </div>

        <div class="prompt-meta">
            <span>
                <i class="fas fa-clock"></i>
                {{ prompt.updated_at.split(' ')[0] if prompt.updated_at else 'N/A' }}
            </span>
            {% if prompt.tags %}
            <span>
                <i class="fas fa-tags"></i>
                {{ prompt.tags }}
            </span>
            {% endif %}
        </div>

        <div class="prompt-actions">
            <button class="btn-copy" onclick="copyToClipboard({{ prompt.id }}, this)">
                <i class="fas fa-copy"></i>
                클립보드로 복사
            </button>

            <a href="{{ url_for('view_prompt', id=prompt.id) }}" class="btn-glass" style="text-decoration: none;">
                <i class="fas fa-eye"></i>
                보기
            </a>

            <a href="{{ url_for('edit_prompt', id=prompt.id) }}" class="btn-glass" style="text-decoration: none;">
                <i class="fas fa-edit"></i>
                수정
            </a>

            <button class="btn-glass" style="color: var(--color-danger);"
                onclick="confirmDelete('{{ url_for('delete_prompt', id=prompt.id) }}', '이 프롬프트를 삭제하시겠습니까?')">
                <i class="fas fa-trash"></i>
                삭제
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- 통계 정보 -->
<div
    style="margin-top: var(--spacing-8); padding: var(--spacing-4); background: var(--glass-bg); border-radius: var(--radius-xl); border: 1px solid var(--glass-border);">
    <div style="display: flex; justify-content: space-around; text-align: center;">
        <div>
            <div
                style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-primary);">
                {{ prompts|length }}
            </div>
            <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">
                총 프롬프트
            </div>
        </div>

        <div>
            <div
                style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-secondary);">
                {{ categories|length }}
            </div>
            <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">
                카테고리
            </div>
        </div>

        <div>
            <div
                style="font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); color: var(--color-success);">
                {{ today_count }}
            </div>
            <div style="font-size: var(--font-size-sm); color: var(--color-text-muted);">
                오늘 업데이트
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- 빈 상태 -->
<div class="empty-state">
    <i class="fas fa-magic"></i>
    <h3>프롬프트가 없습니다</h3>
    <p>첫 번째 프롬프트를 등록해보세요!</p>
    <a href="{{ url_for('new_prompt') }}" class="btn-glass btn-glass-primary"
        style="margin-top: var(--spacing-4); text-decoration: none;">
        <i class="fas fa-plus"></i>
        새 프롬프트 등록
    </a>
</div>
{% endif %}

<!-- 검색 결과가 없는 경우 -->
{% if (search or selected_category) and not prompts %}
<div class="empty-state">
    <i class="fas fa-search"></i>
    <h3>검색 결과가 없습니다</h3>
    <p>다른 검색어나 카테고리를 시도해보세요.</p>
    <a href="{{ url_for('index') }}" class="btn-glass" style="margin-top: var(--spacing-4); text-decoration: none;">
        <i class="fas fa-home"></i>
        전체 목록 보기
    </a>
</div>
{% endif %}
{% endblock %}